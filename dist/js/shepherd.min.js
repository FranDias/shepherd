!function(t,e){"function"==typeof define&&define.amd?define(["tether"],e):"object"==typeof exports?module.exports=e(require("tether")):t.Shepherd=e(t.Tether)}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function n(t){return"undefined"==typeof t}function s(t){return t&&t.constructor===Array}function o(t){return t?t:"shepherd"}function r(t){return t&&t.constructor===Object}function h(t){return"object"==typeof t}function c(t){var e=document.createElement("div");return e.innerHTML=t,e.children[0]}function l(t,e){var i=void 0;return n(t.matches)?n(t.matchesSelector)?n(t.msMatchesSelector)?n(t.webkitMatchesSelector)?n(t.mozMatchesSelector)?n(t.oMatchesSelector)||(i=t.oMatchesSelector):i=t.mozMatchesSelector:i=t.webkitMatchesSelector:i=t.msMatchesSelector:i=t.matchesSelector:i=t.matches,i.call(t,e)}function a(t){if(h(t))return t.hasOwnProperty("element")&&t.hasOwnProperty("on")?t:null;var e=x.exec(t);if(!e)return null;var i=e[2];return"["===i[0]&&(i=i.substring(1,i.length-1)),{element:e[1],on:i}}function u(t,e){if(null===t||n(t))return t;if(h(t))return t;for(var i=t.split(" "),s={},o=e.length-1,r=i.length-1;r>=0;r--){if(0===o){s[e[o]]=i.slice(0,r+1).join(" ");break}s[e[o]]=i[r],o--}return s}var p=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),d=function(t,e,i){for(var n=!0;n;){var s=t,o=e,r=i;n=!1,null===s&&(s=Function.prototype);var h=Object.getOwnPropertyDescriptor(s,o);if(void 0!==h){if("value"in h)return h.value;var c=h.get;if(void 0===c)return;return c.call(r)}var l=Object.getPrototypeOf(s);if(null===l)return;t=l,e=o,i=r,n=!0,h=l=void 0}},f=t.Utils,v=f.Evented,m=f.addClass,y=f.extend,g=f.hasClass,b=f.removeClass,w=f.uniqueId,k=new v,S={"top right":"bottom left","top left":"bottom right","top center":"bottom center","middle right":"middle left","middle left":"middle right","middle center":"middle center","bottom left":"top right","bottom right":"top left","bottom center":"top center",top:"bottom center",left:"middle right",right:"middle left",bottom:"top center",center:"middle center",middle:"middle center"},x=/^(.+) (top|left|right|bottom|center|\[[a-z ]+\])$/,O=function(h){function f(t,i){return e(this,f),d(Object.getPrototypeOf(f.prototype),"constructor",this).call(this,t,i),this.tour=t,this.bindMethods(),this.setOptions(i),this}return i(f,h),p(f,[{key:"bindMethods",value:function(){var t=this,e=["_show","show","hide","isOpen","cancel","complete","scrollTo","destroy","render"];e.map(function(e){t[e]=t[e].bind(t)})}},{key:"setOptions",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=t,this.destroy(),this.id=this.options.id||this.id||"step-"+w();var e=this.options.when;if(e)for(var i in e)if({}.hasOwnProperty.call(e,i)){var o=e[i];this.on(i,o,this)}var h=JSON.stringify(this.options.buttons),c=n(h)||"true"===h,l="{}"===h||"[]"===h||"null"===h||"false"===h,a=!c&&s(this.options.buttons),u=!c&&r(this.options.buttons);c?this.options.buttons=[{text:"Next",action:this.tour.next,classes:"btn"}]:!l&&u?this.options.buttons=[this.options.buttons]:!l&&a||(this.options.buttons=!1)}},{key:"getTour",value:function(){return this.tour}},{key:"bindAdvance",value:function(){var t=this,e=u(this.options.advanceOn,["selector","event"]),i=e.event,s=e.selector,o=function(e){t.isOpen()&&(n(s)?t.el&&e.target===t.el&&t.tour.next():l(e.target,s)&&t.tour.next())};document.body.addEventListener(i,o),this.on("destroy",function(){return document.body.removeEventListener(i,o)})}},{key:"getAttachTo",value:function(){var t=a(this.options.attachTo)||{},e=y({},t);return"string"==typeof t.element&&(e.element=document.querySelector(t.element),e.element||console.error("The element for this Shepherd step was not found "+t.element)),e}},{key:"setupTether",value:function(){if(n(t))throw new Error("Using the attachment feature of Shepherd requires the Tether library");var e=this.getAttachTo(),i=S[e.on]||S.right;n(e.element)&&(e.element="viewport",i="middle center");var s={classPrefix:o(this.options.classPrefix),element:this.el,constraints:[{to:"window",pin:!0,attachment:"together"}],target:e.element,offset:e.offset||"0 0",attachment:i};this.tether&&this.tether.destroy(),this.tether=new t(y(s,this.options.tetherOptions))}},{key:"show",value:function(){var t=this;if(!n(this.options.beforeShowPromise)){var e=this.options.beforeShowPromise();if(!n(e))return e.then(function(){return t._show()})}this._show()}},{key:"_show",value:function(){var t=this;this.trigger("before-show"),this.el||this.render(),m(this.el,this.options.classPrefix+"-open"),document.body.setAttribute("data-"+this.options.classPrefix+"-step",this.id),this.setupTether(),this.options.scrollTo&&setTimeout(function(){t.scrollTo()}),this.trigger("show")}},{key:"hide",value:function(){this.trigger("before-hide"),b(this.el,this.options.classPrefix+"-open"),document.body.removeAttribute("data-"+this.options.classPrefix+"-step"),this.tether&&this.tether.destroy(),this.tether=null,this.trigger("hide")}},{key:"isOpen",value:function(){return this.el&&g(this.el,this.options.classPrefix+"-open")}},{key:"cancel",value:function(){this.tour.cancel(),this.trigger("cancel")}},{key:"complete",value:function(){this.tour.complete(),this.trigger("complete")}},{key:"scrollTo",value:function(){var t=this.getAttachTo(),e=t.element;n(this.options.scrollToHandler)?n(e)||e.scrollIntoView():this.options.scrollToHandler(e)}},{key:"destroy",value:function(){!n(this.el)&&this.el.parentNode&&(this.el.parentNode.removeChild(this.el),delete this.el),this.tether&&this.tether.destroy(),this.tether=null,this.trigger("destroy")}},{key:"render",value:function(){var t=this;n(this.el)||this.destroy(),this.el=c("<div class='"+this.options.classPrefix+"-step "+(this.options.classes||"")+"' data-id='"+this.id+"' "+(this.options.idAttribute?'id="'+this.options.idAttribute+'"':"")+"></div>");var e=document.createElement("div");e.className=this.options.classPrefix+"-content",this.el.appendChild(e);var i=document.createElement("header");if(e.appendChild(i),this.options.title&&(i.innerHTML+="<h3 class='"+this.options.classPrefix+"-title'>"+this.options.title+"</h3>",this.el.className+=" "+this.options.classPrefix+"-has-title"),this.options.showCancelLink){var s=c("<a href class='"+this.options.classPrefix+"-cancel-link'>âœ•</a>");i.appendChild(s),this.el.className+=" "+this.options.classPrefix+"-has-cancel-link",this.bindCancelLink(s)}n(this.options.text)||!function(){var i=c("<div class='"+t.options.classPrefix+"-text'></div>"),n=t.options.text;"function"==typeof n&&(n=n.call(t,i)),n instanceof HTMLElement?i.appendChild(n):("string"==typeof n&&(n=[n]),n.map(function(t){i.innerHTML+="<p>"+t+"</p>"})),e.appendChild(i)}(),this.options.buttons&&!function(){var i=document.createElement("footer"),n=c("<ul class='"+t.options.classPrefix+"-buttons'></ul>");t.options.buttons.map(function(e){var i=c("<li><a class='"+t.options.classPrefix+"-button "+(e.classes||"")+"'>"+e.text+"</a>");n.appendChild(i),t.bindButtonEvents(e,i.querySelector("a"))}),i.appendChild(n),e.appendChild(i)}(),document.body.appendChild(this.el),this.setupTether(),this.options.advanceOn&&this.bindAdvance()}},{key:"bindCancelLink",value:function(t){var e=this;t.addEventListener("click",function(t){t.preventDefault(),e.cancel()})}},{key:"bindButtonEvents",value:function(t,e){var i=this;t.events=t.events||{},n(t.action)||(t.events.click=t.action);for(var s in t.events)if({}.hasOwnProperty.call(t.events,s)){var o=t.events[s];"string"==typeof o&&!function(){var t=o;o=function(){return i.tour.show(t)}}(),e.addEventListener(s,o)}this.on("destroy",function(){for(var i in t.events)if({}.hasOwnProperty.call(t.events,i)){var n=t.events[i];e.removeEventListener(i,n)}})}}]),f}(v),P=function(t){function s(){var t=this,i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];e(this,s),d(Object.getPrototypeOf(s.prototype),"constructor",this).call(this,i),this.bindMethods(),this.options=i,this.steps=this.options.steps||[];var n=["complete","cancel","hide","start","show","active","inactive"];return n.map(function(e){!function(e){t.on(e,function(i){i=i||{},i.tour=t,k.trigger(e,i)})}(e)}),this}return i(s,t),p(s,[{key:"bindMethods",value:function(){var t=this,e=["next","back","cancel","complete","hide"];e.map(function(e){t[e]=t[e].bind(t)})}},{key:"addStep",value:function(t,e){return n(e)&&(e=t),e instanceof O?e.tour=this:("string"!=typeof t&&"number"!=typeof t||(e.id=t.toString()),e=y({},this.options.defaults,e),e=new O(this,e)),this.steps.push(e),this}},{key:"removeStep",value:function(t){for(var e=this.getCurrentStep(),i=0;i<this.steps.length;++i){var n=this.steps[i];if(n.id===t){n.isOpen()&&n.hide(),n.destroy(),this.steps.splice(i,1);break}}e&&e.id===t&&(this.currentStep=void 0,this.steps.length?this.show(0):this.hide())}},{key:"getById",value:function(t){for(var e=0;e<this.steps.length;++e){var i=this.steps[e];if(i.id===t)return i}}},{key:"getCurrentStep",value:function(){return this.currentStep}},{key:"next",value:function(){var t=this.steps.indexOf(this.currentStep);t===this.steps.length-1?(this.hide(t),this.trigger("complete"),this.done()):this.show(t+1,!0)}},{key:"back",value:function(){var t=this.steps.indexOf(this.currentStep);this.show(t-1,!1)}},{key:"cancel",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("cancel"),this.done()}},{key:"complete",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("complete"),this.done()}},{key:"hide",value:function(){this.currentStep&&this.currentStep.hide(),this.trigger("hide"),this.done()}},{key:"done",value:function(){k.activeTour=null,b(document.body,o(this.options.defaults.classPrefix)+"-active"),this.trigger("inactive",{tour:this})}},{key:"show",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],e=arguments.length<=1||void 0===arguments[1]||arguments[1];this.currentStep?this.currentStep.hide():(m(document.body,o(this.options.defaults.classPrefix)+"-active"),this.trigger("active",{tour:this})),k.activeTour=this;var i=void 0;if(i="string"==typeof t?this.getById(t):this.steps[t])if(n(i.options.showOn)||i.options.showOn())this.trigger("show",{step:i,previous:this.currentStep}),this.currentStep&&this.currentStep.hide(),this.currentStep=i,i.show();else{var s=this.steps.indexOf(i),r=e?s+1:s-1;this.show(r,e)}}},{key:"start",value:function(){this.trigger("start"),this.currentStep=null,this.next()}}]),s}(v);return y(k,{Tour:P,Step:O,Evented:v}),k});